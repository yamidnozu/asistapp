import { FastifyInstance } from 'fastify';
import AuthController from '../controllers/auth.controller';
import { authenticate } from '../middleware/auth';

export default async function authRoutes(fastify: FastifyInstance) {
  console.log('üîê AUTH ROUTES: Registrando rutas de autenticaci√≥n...');

  fastify.register(async function (authRoutes) {

    authRoutes.post('/login', {






      handler: AuthController.login,
    });

    authRoutes.post('/login-test', {
      handler: AuthController.login,
    });

    authRoutes.get('/verify', {
      preHandler: authenticate,
      handler: AuthController.verify,
    });

    authRoutes.get('/instituciones', {
      preHandler: authenticate,
      handler: AuthController.getUserInstitutions,
    });

    authRoutes.get('/periodos', {
      preHandler: authenticate,
      handler: AuthController.getUserPeriodos,
    });

    authRoutes.post('/logout', {
      preHandler: authenticate,
      handler: AuthController.logout,
    });

    authRoutes.post('/refresh', {
      config: {
        rateLimit: {
          max: 10,
          timeWindow: '15 minutes',
        },
      },
      handler: AuthController.refreshToken,
    });
  });
}