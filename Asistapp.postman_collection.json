{
	"info": {
		"_postman_id": "d8fbb4e0-f89c-4806-aebf-710f997ad1ed",
		"name": "ü™ô Asistapp API v2.0",
		"description": "Colecci√≥n completa para probar la API de AsistApp Backend v2.0\n\n## Credenciales por Defecto\n\n**Super Admin:**\n- Email: superadmin@asistapp.com\n- Password: Admin123!\n\n**Admin San Jos√©:**\n- Email: admin@sanjose.edu\n- Password: SanJose123!\n\n**Admin FPS:**\n- Email: admin@fps.edu\n- Password: Fps123!\n\n**Usuario Multi-instituci√≥n:**\n- Email: multi@asistapp.com\n- Password: Multi123!\n\n**Profesores:**\n- pedro.garcia@sanjose.edu / Prof123!\n- ana.lopez@sanjose.edu / Prof456!\n\n**Estudiantes:**\n- [nombre].[apellido]@sanjose.edu / Est123!\n\n## Uso\n\n1. Importar el environment: Asistapp.postman_environment.json\n2. Ejecutar 'Login - Super Admin' para obtener token\n3. El token se guarda autom√°ticamente en las variables de entorno\n4. Probar los dem√°s endpoints\n\n## Rutas Corregidas\n\nTodas las rutas de usuarios han sido corregidas y ahora funcionan correctamente:\n- GET /usuarios\n- GET /usuarios/:id\n- GET /usuarios/rol/:role\n- GET /usuarios/institucion/:institucionId\n- POST /usuarios/admin/cleanup-tokens",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health Check",
			"item": [
				{
					"name": "API Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Health check exitoso\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"    pm.expect(jsonData.message).to.include('AsistApp Backend');",
									"    pm.expect(jsonData.timestamp).to.be.a('string');",
									"});",
									"",
									"console.log('‚úÖ API funcionando correctamente');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": [""]
						},
						"description": "Verificar que la API est√© funcionando"
					}
				}
			]
		},
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Login - Super Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Verificar que el login fue exitoso",
									"pm.test(\"Login exitoso\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.have.property('accessToken');",
									"        pm.expect(jsonData.data).to.have.property('refreshToken');",
									"        pm.expect(jsonData.data).to.have.property('usuario');",
									"        pm.expect(jsonData.data).to.have.property('expiresIn');",
									"        pm.expect(jsonData.data.expiresIn).to.be.a('number');",
									"    }",
									"});",
									"",
									"// Actualizar variables del environment solo si el login fue exitoso",
									"var jsonData = pm.response.json();",
									"if (jsonData.success && jsonData.data) {",
									"    pm.environment.set('accessToken', jsonData.data.accessToken);",
									"    pm.environment.set('refreshToken', jsonData.data.refreshToken);",
									"    pm.environment.set('userId', jsonData.data.usuario.id);",
									"    pm.environment.set('currentUserRole', jsonData.data.usuario.rol);",
									"    pm.environment.set('currentUserEmail', jsonData.data.usuario.nombres + ' ' + jsonData.data.usuario.apellidos + ' (' + jsonData.data.usuario.email + ')');",
									"    pm.environment.set('instituciones', JSON.stringify(jsonData.data.usuario.instituciones || []));",
									"    ",
									"    console.log('‚úÖ Login exitoso - Token actualizado');",
									"    console.log('Usuario:', jsonData.data.usuario.nombres + ' ' + jsonData.data.usuario.apellidos);",
									"    console.log('Rol:', jsonData.data.usuario.rol);",
									"    console.log('Instituciones:', jsonData.data.usuario.instituciones ? jsonData.data.usuario.instituciones.length : 0);",
									"} else {",
									"    console.log('‚ùå Login fallido:', jsonData.error || 'Error desconocido');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\"email\": \"superadmin@asistapp.com\", \"password\": \"Admin123!\"}"
						},
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/auth/login",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["auth", "login"]
						},
						"description": "Login como Super Admin (usuario creado por seed: superadmin@asistapp.com, password: Admin123!)"
					}
				},
				{
					"name": "Login Test - Sin Rate Limit",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Verificar que el login fue exitoso",
									"pm.test(\"Login exitoso\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.have.property('accessToken');",
									"        pm.expect(jsonData.data).to.have.property('refreshToken');",
									"        pm.expect(jsonData.data).to.have.property('usuario');",
									"        pm.expect(jsonData.data).to.have.property('expiresIn');",
									"        pm.expect(jsonData.data.expiresIn).to.be.a('number');",
									"    }",
									"});",
									"",
									"// Actualizar variables del environment solo si el login fue exitoso",
									"var jsonData = pm.response.json();",
									"if (jsonData.success && jsonData.data) {",
									"    pm.environment.set('accessToken', jsonData.data.accessToken);",
									"    pm.environment.set('refreshToken', jsonData.data.refreshToken);",
									"    pm.environment.set('userId', jsonData.data.usuario.id);",
									"    pm.environment.set('currentUserRole', jsonData.data.usuario.rol);",
									"    pm.environment.set('currentUserEmail', jsonData.data.usuario.nombres + ' ' + jsonData.data.usuario.apellidos + ' (' + jsonData.data.usuario.email + ')');",
									"    pm.environment.set('instituciones', JSON.stringify(jsonData.data.usuario.instituciones || []));",
									"    ",
									"    console.log('‚úÖ Login exitoso - Token actualizado (sin rate limit)');",
									"    console.log('Usuario:', jsonData.data.usuario.nombres + ' ' + jsonData.data.usuario.apellidos);",
									"    console.log('Rol:', jsonData.data.usuario.rol);",
									"    console.log('Instituciones:', jsonData.data.usuario.instituciones ? jsonData.data.usuario.instituciones.length : 0);",
									"} else {",
									"    console.log('‚ùå Login fallido:', jsonData.error || 'Error desconocido');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\"email\": \"superadmin@asistapp.com\", \"password\": \"Admin123!\"}"
						},
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/auth/login-test",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["auth", "login-test"]
						},
						"description": "Login sin rate limiting (solo para desarrollo/testing) - Super Admin"
					}
				},
				{
					"name": "Get User Institutions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Verificar que se obtuvieron las instituciones",
									"pm.test(\"Instituciones obtenidas\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.be.an('array');",
									"    }",
									"});",
									"",
									"// Guardar primera instituci√≥n como variable de environment",
									"var jsonData = pm.response.json();",
									"if (jsonData.success && jsonData.data && jsonData.data.length > 0) {",
									"    pm.environment.set('institucionId', jsonData.data[0].id);",
									"    pm.environment.set('institucionNombre', jsonData.data[0].nombre);",
									"    ",
									"    console.log('‚úÖ Instituciones obtenidas: ' + jsonData.data.length);",
									"    console.log('Primera instituci√≥n: ' + jsonData.data[0].nombre);",
									"} else {",
									"    console.log('‚ÑπÔ∏è No hay instituciones disponibles o error:', jsonData.error || 'Sin instituciones');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/auth/instituciones",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["auth", "instituciones"]
						},
						"description": "Obtener instituciones del usuario autenticado"
					}
				},
				{
					"name": "Verify Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Token v√°lido\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.have.property('usuario');",
									"        pm.expect(jsonData.data).to.have.property('valid');",
									"        pm.expect(jsonData.data.valid).to.eql(true);",
									"    }",
									"});",
									"",
									"console.log('‚úÖ Token verificado correctamente');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/auth/verify",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["auth", "verify"]
						},
						"description": "Verificar token de acceso"
					}
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    var status = pm.response.code;",
									"    pm.expect(status).to.be.oneOf([200, 401]);",
									"});",
									"",
									"// Verificar que el refresh fue exitoso",
									"pm.test(\"Refresh exitoso\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.have.property('accessToken');",
									"        pm.expect(jsonData.data).to.have.property('refreshToken');",
									"        pm.expect(jsonData.data).to.have.property('expiresIn');",
									"    }",
									"});",
									"",
									"// Actualizar variables del environment con los nuevos tokens",
									"var jsonData = pm.response.json();",
									"if (jsonData.success && jsonData.data) {",
									"    pm.environment.set('accessToken', jsonData.data.accessToken);",
									"    pm.environment.set('refreshToken', jsonData.data.refreshToken);",
									"    ",
									"    console.log('‚úÖ Token refrescado exitosamente');",
									"    console.log('Nuevo access token actualizado');",
									"} else {",
									"    console.log('‚ùå Refresh fallido:', jsonData.error || 'Error desconocido');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\"refreshToken\": \"{{refreshToken}}\"}"
						},
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/auth/refresh",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["auth", "refresh"]
						},
						"description": "Refrescar access token enviando refreshToken en el body"
					}
				},
				{
					"name": "Logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    var status = pm.response.code;",
									"    pm.expect(status).to.be.oneOf([200, 401]);",
									"});",
									"",
									"// Verificar que el logout fue exitoso",
									"pm.test(\"Logout exitoso\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.have.property('message');",
									"    }",
									"});",
									"",
									"// Limpiar variables del environment",
									"pm.environment.set('accessToken', '');",
									"pm.environment.set('refreshToken', '');",
									"pm.environment.set('userId', '');",
									"pm.environment.set('currentUserRole', '');",
									"pm.environment.set('currentUserEmail', '');",
									"pm.environment.set('institucionId', '');",
									"",
									"console.log('‚úÖ Sesi√≥n cerrada - Variables limpiadas');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\"refreshToken\": \"{{refreshToken}}\"}"
						},
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/auth/logout",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["auth", "logout"]
						},
						"description": "Cerrar sesi√≥n enviando refreshToken en el body"
					}
				}
			]
		},
		{
			"name": "Users Management",
			"item": [
				{
					"name": "Get All Users",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    var status = pm.response.code;",
									"    pm.expect(status).to.be.oneOf([200, 403, 401]);",
									"});",
									"",
									"pm.test(\"Usuarios obtenidos\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.be.an('array');",
									"    }",
									"});",
									"",
									"console.log('‚úÖ Usuarios obtenidos: ' + (pm.response.json().data ? pm.response.json().data.length : 0));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/usuarios",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["usuarios"]
						},
						"description": "Obtener todos los usuarios (requiere admin)"
					}
				},
				{
					"name": "Get User by ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    var status = pm.response.code;",
									"    pm.expect(status).to.be.oneOf([200, 404, 401]);",
									"});",
									"",
									"pm.test(\"Usuario obtenido\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.have.property('id');",
									"        pm.expect(jsonData.data).to.have.property('email');",
									"    }",
									"});",
									"",
									"console.log('‚úÖ Usuario obtenido:', pm.response.json().data ? pm.response.json().data.email : 'N/A');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/usuarios/{{userId}}",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["usuarios", "{{userId}}"]
						},
						"description": "Obtener usuario por ID"
					}
				},
				{
					"name": "Get Users by Role",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    var status = pm.response.code;",
									"    pm.expect(status).to.be.oneOf([200, 403, 401]);",
									"});",
									"",
									"pm.test(\"Usuarios por rol obtenidos\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.be.an('array');",
									"    }",
									"});",
									"",
									"console.log('‚úÖ Usuarios por rol obtenidos: ' + (pm.response.json().data ? pm.response.json().data.length : 0));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/usuarios/rol/{{role}}",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["usuarios", "rol", "{{role}}"]
						},
						"description": "Obtener usuarios por rol (requiere admin)"
					}
				},
				{
					"name": "Get Users by Institution",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    var status = pm.response.code;",
									"    pm.expect(status).to.be.oneOf([200, 403, 401]);",
									"});",
									"",
									"pm.test(\"Usuarios por instituci√≥n obtenidos\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.be.an('array');",
									"    }",
									"});",
									"",
									"console.log('‚úÖ Usuarios por instituci√≥n obtenidos: ' + (pm.response.json().data ? pm.response.json().data.length : 0));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/usuarios/institucion/{{institucionId}}",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["usuarios", "institucion", "{{institucionId}}"]
						},
						"description": "Obtener usuarios por instituci√≥n"
					}
				},
				{
					"name": "Cleanup Tokens",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verificar respuesta del servidor",
									"pm.test(\"Respuesta del servidor\", function () {",
									"    var status = pm.response.code;",
									"    pm.expect(status).to.be.oneOf([200, 403, 401]);",
									"});",
									"",
									"pm.test(\"Limpieza exitosa\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    if (jsonData.success) {",
									"        pm.expect(jsonData.data).to.have.property('message');",
									"    }",
									"});",
									"",
									"console.log('‚úÖ Limpieza de tokens completada');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{host}}:{{port}}/usuarios/admin/cleanup-tokens",
							"protocol": "{{protocol}}",
							"host": ["{{host}}"],
							"port": "{{port}}",
							"path": ["usuarios", "admin", "cleanup-tokens"]
						},
						"description": "Limpiar tokens expirados (solo super_admin)"
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "{{protocol}}://{{host}}:{{port}}",
			"type": "string",
			"description": "URL base (usar variable de environment)"
		},
		{
			"key": "accessToken",
			"value": "{{accessToken}}",
			"type": "string",
			"description": "Token de acceso JWT (se actualiza autom√°ticamente)"
		},
		{
			"key": "userId",
			"value": "{{userId}}",
			"type": "string",
			"description": "ID de usuario para pruebas espec√≠ficas"
		},
		{
			"key": "role",
			"value": "{{role}}",
			"type": "string",
			"description": "Rol para filtrar usuarios"
		}
	]
}