00:00 +0: loading C:/Proyectos/DemoLife/integration_test/main_e2e_test.dart
Building Windows application...                                    28,0s
âˆš Built build\windows\x64\runner\Debug\asistapp.exe
00:00 +0: ğŸš€ FLUJO E2E TRANSACCIONAL - MICRO-UNIVERSO AISLADO

======================================================================
ğŸ¯ INICIANDO TEST E2E TRANSACCIONAL - MICRO-UNIVERSO AISLADO
   Timestamp Ãºnico: 86166172
   DÃ­a de hoy (UTC): SÃ¡bado (6)
   Hora actual (UTC): 1:56
   Horario a crear: 01:00 - 02:00

   ğŸ“¦ DATOS ÃšNICOS A CREAR:
   â€¢ InstituciÃ³n: Instituto 86166172
   â€¢ Admin: admin_86166172@test.com
   â€¢ Profesor: profe_86166172@test.com
   â€¢ Estudiante: estu_86166172@test.com
   â€¢ PerÃ­odo: Periodo 86166172
   â€¢ Materia: Materia 86166172
   â€¢ Grupo: Grupo 86166172

   âš ï¸ MODO ESTRICTO: Sin fallbacks al seed
======================================================================

AppConfig: No se pudo cargar .env: Instance of 'FileNotFoundError'
AppConfig: Rutas intentadas para .env (muestra hasta 30):
  - C:\Proyectos\DemoLife\.env
  - C:\Proyectos\DemoLife\.env
  - C:\Proyectos\DemoLife\build\windows\x64\runner\Debug\.env
  - C:\Proyectos\DemoLife\build\windows\x64\runner\.env
  - C:\Proyectos\DemoLife\build\windows\x64\.env
  - C:\Proyectos\DemoLife\build\windows\.env
  - C:\Proyectos\DemoLife\build\.env
  - C:\Proyectos\DemoLife\.env
  - C:\Proyectos\DemoLife\build\windows\x64\runner\.env
  - C:\Proyectos\DemoLife\build\windows\x64\.env
  - C:\Proyectos\DemoLife\build\windows\.env
  - C:\Proyectos\DemoLife\build\.env
  - C:\Proyectos\DemoLife\.env
AppConfig: Usando configuraciÃ³n por defecto
  - API_BASE_URL: http://192.168.20.22:3000
  - ENVIRONMENT: development
  - Plataforma: windows

ğŸ“ FASE 1: GÃ‰NESIS (Super Admin crea InstituciÃ³n + Admin)

AuthService.login - URL: http://192.168.20.22:3000/auth/login
AuthService.login - Config Base URL: http://192.168.20.22:3000
ğŸ“¤ POST /auth/login
ğŸ“¡ HTTP 200 /auth/login
   Status: 200
   Body: {"success":true,"data":{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3NzRiYzI1LWM0ZmEtNGZhMy1iOTkyLWU2YTQ0NTlhY2M3MiIsInJvbCI6InN1cGVyX2FkbWluIiwiZW1haWwiOiJzdXBlcmFkbWluQGFzaXN0YXBwLmNvbSIsInRva2VuVmVyc2lvbiI6MSwiaWF0IjoxNzY0OTg2MjEwLCJleHAiOjE3NjUwNzI2MTB9.R1-Cu4rwfrEhFaXZAatM0kIttYhp3JAG1PcKREaKsGo","refreshToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3NzRiYzI1LWM0ZmEtNGZhMy1iOTkyLWU2YTQ0NTlhY2M3MiIsInJvbCI6InN1cGVyX2FkbWluIiwiZW1haWwiOiJzdXBlcmFkbWluQGFzaXN0YXBwLmNvbSIsInRva2VuVmVyc2lvbiI6MSwianRpIjoiMzYzYjcwOGMtYzY5My00YWY4LTlmNWQtYjcxZTAxZjM3M2NhIiwiaWF0IjoxNzY0OTg2MjEwLCJleHAiOjE3NjU1OTEwMTB9._Zfmoel-912ODnswGhFCDTEk9BobK4qRnspwrrbMPUQ","expiresIn":24,"usuario":{"id":"6774bc25-c4fa-4fa3-b992-e6a4459acc72","nombres":"Super","apellidos":"Administrador","rol":"super_admin","instituciones":[]}}}
========================================
ğŸ“¤ GET /auth/institutions
ğŸ“¡ HTTP 200 /auth/institutions
Super Admin: No requiere selecciÃ³n de instituciÃ³n (acceso global)
Login exitoso, AuthWrapper manejarÃ¡ la navegaciÃ³n
UserProvider: Iniciando carga de usuarios...
VersiÃ³n obtenida del pubspec: 1.0.11
GET /usuarios - Status: 200
InstitutionProvider: Iniciando carga de instituciones...
GET /instituciones - Status: 200
GET /instituciones - data[0]: {id: 6ac5d715-74e8-4bb9-a340-504b3d976b9a, nombre: Instituto 58153478, direccion: Calle Test 123, telefono: 555-58153478, email: test_58153478@test.edu, activa: true, createdAt: 2025-12-05T18:10:50.058Z, updatedAt: 2025-12-05T18:10:50.058Z}
InstitutionProvider: Estado cambiado a loaded
  âœ… [FASE 1] 1.1 Login Super Admin
Cargando instituciones con token: eyJhbGciOiJIUzI1NiIs...
InstitutionProvider: Iniciando carga de instituciones...
GET /instituciones - Status: 200
GET /instituciones - data[0]: {id: 6ac5d715-74e8-4bb9-a340-504b3d976b9a, nombre: Instituto 58153478, direccion: Calle Test 123, telefono: 555-58153478, email: test_58153478@test.edu, activa: true, createdAt: 2025-12-05T18:10:50.058Z, updatedAt: 2025-12-05T18:10:50.058Z}
InstitutionProvider: Estado cambiado a loaded
Instituciones cargadas: 6
Estado del provider: isLoading=false, hasError=false
  âœ… [FASE 1] 1.2 Navegar a Instituciones
    ğŸ“± [NOTIFICACIONES] Configurando notificaciones del micro-universo...
  âœ… [FASE 1] 1.3a SecciÃ³n Notificaciones visible
    ğŸ“± [NOTIFICACIONES] Encontrados 2 switches
    ğŸ“± [NOTIFICACIONES] Estado inicial switch notificaciones: false
  âœ… [FASE 1] 1.3b Activar notificaciones
    ğŸ“± [NOTIFICACIONES] Dropdowns encontrados: 2
  âœ… [FASE 1] 1.3c Seleccionar canal WhatsApp
  âœ… [FASE 1] 1.3d Seleccionar modo InstantÃ¡neo
    ğŸ“± [NOTIFICACIONES] Resumen configuraciÃ³n:
       â€¢ Activas: true
       â€¢ Canal: WHATSAPP
       â€¢ Modo: INSTANT
POST /instituciones - Status: 201
PUT http://192.168.20.22:3000/api/institutions/72348cd2-e074-4287-a977-2c13447d6573/notification-config - Status: 200
GET /instituciones/72348cd2-e074-4287-a977-2c13447d6573 - Status: 200
GET /instituciones/72348cd2-e074-4287-a977-2c13447d6573 - data: {id: 72348cd2-e074-4287-a977-2c13447d6573, nombre: Instituto 86166172, direccion: Calle Test 123, telefono: 555-86166172, email: test_86166172@test.edu, activa: true, configuraciones: {notificacionesActivas: true, canalNotificacion: WHATSAPP, modoNotificacionAsistencia: INSTANT, horaDisparoNotificacion: null, umbralFaltas: 3}, createdAt: 2025-12-06T01:57:42.363Z, updatedAt: 2025-12-06T01:57:42.363Z}
InstitutionProvider: loadInstitutionById - fetched: Institution(id: 72348cd2-e074-4287-a977-2c13447d6573, nombre: Instituto 86166172, activa: true)
  âœ… [FASE 1] 1.3 Crear InstituciÃ³n (Instituto 86166172)
Cargando usuarios (admin_institucion y super_admin) como super_admin...
UserProvider: Iniciando carga de usuarios...
GET /usuarios - Status: 200
  âœ… [FASE 1] 1.4 Navegar a gestiÃ³n de usuarios
    ğŸ“ [DEBUG] Iniciando creaciÃ³n de Admin InstituciÃ³n...
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
    ğŸ“ [DEBUG] SpeedDial tapado: true
    ğŸ“ [STEP 1] InformaciÃ³n de Cuenta
    ğŸ“ [STEP 1] TextFormFields encontrados: 6
    ğŸ“ [STEP 1] Campo email encontrado, llenando: admin_86166172@test.com
    ğŸ“ [STEP 1] Seleccionando instituciÃ³n: Instituto 86166172
       ğŸ“¦ [selectInstitutionFromModal] Iniciando para: Instituto 86166172
       ğŸ“¦ [selectInstitutionFromModal] Campo instituciÃ³n encontrado, haciendo tap...
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
       ğŸ“¦ [selectInstitutionFromModal] BottomSheets encontrados: 1
       ğŸ“¦ [selectInstitutionFromModal] CheckboxListTiles encontrados: 5
       ğŸ“¦ [selectInstitutionFromModal] Textos que contienen "Instituto 86166172": 1
       ğŸ“¦ [selectInstitutionFromModal] Encontrado! Haciendo tap...
       ğŸ“¦ [selectInstitutionFromModal] Botones "Confirmar selecciÃ³n": 1
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
       âœ… [selectInstitutionFromModal] Confirmado!
    ğŸ“ [STEP 1] InstituciÃ³n seleccionada: true
    ğŸ“ [STEP 1] Avanzando a Step 2...
    ğŸ“ [STEP 1] Botones formSaveButton encontrados: 2
ğŸ”” _onStepContinue CALLED! currentStep=0
ğŸ”” totalSteps=2
ğŸ”” stepState for step 0: FormState#1c30f
ğŸ”” validation result: true
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
    ğŸ“ [STEP 2] InformaciÃ³n Personal
    ğŸ“ [STEP 2] TextFormFields ahora: 6
    ğŸ“ [STEP 2] Step widgets encontrados: 0
    ğŸ“ [STEP 2] Textos "Info Personal" encontrados: 1
    ğŸ“ [STEP 2] Campo nombres encontrado: true
    ğŸ“ [STEP 2] Campo apellidos encontrado: true
    ğŸ“ [STEP 2] Campo nombres encontrado por Key
    ğŸ“ [STEP 2] Texto ingresado en nombres: Admin 86166172
    ğŸ“ [STEP 2] Campo apellidos encontrado por Key
    ğŸ“ [STEP 2] Texto ingresado en apellidos: TestApellido
    ğŸ“ [STEP 2] Datos personales llenados
    ğŸ“ [STEP 2] Buscando botÃ³n de guardar (Crear)...
    ğŸ“ [STEP 2] Botones con texto "Crear" encontrados: 2
ğŸ”” _onStepContinue CALLED! currentStep=1
ğŸ”” totalSteps=2
ğŸ”” stepState for step 1: FormState#76c16
ğŸ”” validation result: true
    ğŸ“ [STEP 2] BotÃ³n "Crear" tapado (usando last), esperando respuesta del servidor...
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
POST /usuarios - Status: 201
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
    ğŸ“ [STEP 2] Textos "ContraseÃ±a" encontrados: 1
    ğŸ”‘ ContraseÃ±a capturada exitosamente: x)mp(eIYDV4n
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
UserFormScreen: sessionRole=super_admin, userRole=admin_institucion, isSelfEditing=false, canEditInstitutions=true
  âœ… [FASE 1] 1.5 Crear Admin InstituciÃ³n (admin_86166172@test.com)
ğŸ“¤ POST /auth/logout
ğŸ“¡ HTTP 404 /auth/logout
AppConfig: No se pudo cargar .env: Instance of 'FileNotFoundError'
AppConfig: Rutas intentadas para .env (muestra hasta 30):
  - C:\Proyectos\DemoLife\.env
  - C:\Proyectos\DemoLife\.env
  - C:\Proyectos\DemoLife\build\windows\x64\runner\Debug\.env
  - C:\Proyectos\DemoLife\build\windows\x64\runner\.env
  - C:\Proyectos\DemoLife\build\windows\x64\.env
  - C:\Proyectos\DemoLife\build\windows\.env
  - C:\Proyectos\DemoLife\build\.env
  - C:\Proyectos\DemoLife\.env
  - C:\Proyectos\DemoLife\build\windows\x64\runner\.env
  - C:\Proyectos\DemoLife\build\windows\x64\.env
  - C:\Proyectos\DemoLife\build\windows\.env
  - C:\Proyectos\DemoLife\build\.env
  - C:\Proyectos\DemoLife\.env
AppConfig: Usando configuraciÃ³n por defecto
  - API_BASE_URL: http://192.168.20.22:3000
  - ENVIRONMENT: development
  - Plataforma: windows
  âœ… [FASE 1] 1.6 Logout Super Admin

ğŸ“ FASE 2: ESTRUCTURA (Admin crea PerÃ­odo, Materia, Profesor, Estudiante, Grupo, Horario)

AuthService.login - URL: http://192.168.20.22:3000/auth/login
AuthService.login - Config Base URL: http://192.168.20.22:3000
ğŸ“¤ POST /auth/login
ğŸ“¡ HTTP 200 /auth/login
   Status: 200
   Body: {"success":true,"data":{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImU4MTVjYjYwLTJhN2EtNGM5YS1hZmVjLTA3YzdlZDBiOGQ5NCIsInJvbCI6ImFkbWluX2luc3RpdHVjaW9uIiwiZW1haWwiOiJhZG1pbl84NjE2NjE3MkB0ZXN0LmNvbSIsInRva2VuVmVyc2lvbiI6MSwiaWF0IjoxNzY0OTg2MzIzLCJleHAiOjE3NjUwNzI3MjN9.h7yuDxDsNEEpOQeh2SW1YAu0vuDmftq0ZXlDc82Qwpo","refreshToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImU4MTVjYjYwLTJhN2EtNGM5YS1hZmVjLTA3YzdlZDBiOGQ5NCIsInJvbCI6ImFkbWluX2luc3RpdHVjaW9uIiwiZW1haWwiOiJhZG1pbl84NjE2NjE3MkB0ZXN0LmNvbSIsInRva2VuVmVyc2lvbiI6MSwianRpIjoiZjU0ZmE4NWYtYzE5MS00NGEwLWE2ODEtNzY4NWE4OWQ1NmE2IiwiaWF0IjoxNzY0OTg2MzIzLCJleHAiOjE3NjU1OTExMjN9.i9Y-HreBSTCbVC83tnK1c2vHjOii8uGHZz64sH7Lj14","expiresIn":24,"usuario":{"id":"e815cb60-2a7a-4c9a-afec-07c7ed0b8d94","nombres":"Admin 86166172","apellidos":"TestApellido","rol":"admin_institucion","instituciones":[{"id":"72348cd2-e074-4287-a977-2c13447d6573","nombre":"Instituto 86166172","rolEnInstitucion":"admin"}]}}}
========================================
ğŸ“¤ GET /auth/institutions
ğŸ“¡ HTTP 200 /auth/institutions
InstituciÃ³n seleccionada automÃ¡ticamente: 72348cd2-e074-4287-a977-2c13447d6573
Login exitoso, AuthWrapper manejarÃ¡ la navegaciÃ³n
UserProvider: Iniciando carga de usuarios por instituciÃ³n 72348cd2-e074-4287-a977-2c13447d6573...
VersiÃ³n obtenida del pubspec: 1.0.11
GET /usuarios/institucion/72348cd2-e074-4287-a977-2c13447d6573 - Status: 200
  âœ… [FASE 2] 2.1 Login Admin (admin_86166172@test.com)
  âœ… [FASE 2] 2.2 Dashboard Admin visible
  âœ… [FASE 2] 2.3 Crear PerÃ­odo (Usando perÃ­odos existentes)
  âœ… [FASE 2] 2.4 Crear Materia (Usando materias existentes)
Cargando usuarios para la instituciÃ³n: 72348cd2-e074-4287-a977-2c13447d6573
UserProvider: Iniciando carga de usuarios por instituciÃ³n 72348cd2-e074-4287-a977-2c13447d6573...
GET /usuarios/institucion/72348cd2-e074-4287-a977-2c13447d6573 - Status: 200
